{% extends "layout.html" %}
{% block main %}

<h2>{{ case['title'] }}</h2>

<div class="MenuItem"><a href='/cases/{{ case['_id'] }}/edit'>Editar</a></div>

{{ case['overview'] | safe }}

<p>
<strong>Fuente del requerimiento:</strong>
{% if case['requester'] == '0' %}
    Interno
{% else %}
    Externo
{% endif %}
</p>

<ul class="tab">
    <li><a href="#" class="tablinks" onclick="openTab(event, 'updates')">Actualizaciones</a></li>
    <li><a href="#" class="tablinks" onclick="openTab(event, 'requests')">Peticiones</a></li>
    <li><a href="#" class="tablinks" onclick="openTab(event, 'complains')">Denuncias</a></li>
    <li><a href="#" class="tablinks" onclick="openTab(event, 'advises')">Asesor√≠a</a></li>
</ul>

<div id="updates" class="tabcontent">
    <form action='/updates/new/' method="post">
        <input type="hidden" name="source" value="case">
        <input type="hidden" name="source_id" value="{{ case['_id'] }}">
        <input class="Inline" type="date" size="8" name="date" placeholder="Fecha">
        <textarea class="Inline" name="detail" cols="60" rows="10" placeholder="Detalle"></textarea>
        <button>Actualizar</button>
    </form>
    <ul class="List">
        {% for update in updates %}
            <li class="ListItem">{{ update['date'] }}: {{ update['detail'] | safe }}</li>
        {% endfor %}
    </ul>
</div>

<div id="requests" class="tabcontent">
    <div class="MenuItem"><a href="/requests/new/?case_id={{ case['_id'] }}">Nueva...</a></div>
    <ul class="List">
    {% for request in requests %}
        <li class="ListItem">{{ request['ref'] }}. <a href="/requests/{{ request['_id'] }}">{{ request['overview'] }}</a></li>
    {% endfor %}
    </ul>
</div>

<div id="complains" class="tabcontent">
    <div class="MenuItem"><a href="/complains/new/?case_id={{ case['_id'] }}">Nueva...</a></div>
    <ul class="List">
    {% for complain in complains %}
        <li class="ListItem">{{ complain['ref'] }}. <a href="/complains/{{ complain['_id'] }}">{{ complain['overview'] }}</a></li>
    {% endfor %}
    </ul>
</div>

<div id="advises" class="tabcontent">
    <form action='/updates/new/' method="post">
        <input type="hidden" name="source" value="advise">
        <input type="hidden" name="source_id" value="{{ case['_id'] }}">
        <input class="Inline" type="date" size="8" name="date" placeholder="Fecha">
        <textarea class="Inline" name="detail" cols="60" rows="10" placeholder="Detalle"></textarea>
        <button>Actualizar</button>
    </form>
    <ul class="List">
        {% for advice in advices %}
            <li class="ListItem">{{ advice['date'] }}: {{ advice['detail'] | safe }}</li>
        {% endfor %}
    </ul>
</div>

<script>
function openTab(evt, tabName) {
    // Declare all variables
    var i, tabcontent, tablinks;

    // Get all elements with class="tabcontent" and hide them
    tabcontent = document.getElementsByClassName("tabcontent");
    for (i = 0; i < tabcontent.length; i++) {
        tabcontent[i].style.display = "none";
    }

    // Get all elements with class="tablinks" and remove the class "active"
    tablinks = document.getElementsByClassName("tablinks");
    for (i = 0; i < tablinks.length; i++) {
        tablinks[i].className = tablinks[i].className.replace(" active", "");
    }

    // Show the current tab, and add an "active" class to the link that opened the tab
    document.getElementById(tabName).style.display = "block";
    evt.currentTarget.className += " active";
}
</script>

{% endblock %}
